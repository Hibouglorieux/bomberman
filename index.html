<!DOCTYPE html>
<html>
<head>
    <script src="./phaser/dist/phaser.js"></script>
	<script src="create_anim.js"></script>
	<script src="manage_mvt.js"></script>
</head>
<body>

    <script>
    const level = [
        [   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1],
        [   1,   0,   0,   2,   2,   2,   2,   2,   2,   2,   2,   2,   0,   0,   1],
        [   1,   0,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   0,   1],
        [   1,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   1],
        [   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1],
        [   1,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   1],
        [   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1],
        [   1,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   1],
        [   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1],
        [   1,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   1],
        [   1,   0,   1,   2,   1,   2,   1,   2,   1,   2,   1,   2,   1,   0,   1],
        [   1,   0,   0,   2,   2,   2,   2,   2,   2,   2,   2,   2,   0,   0,   1],
        [   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1]
    ];
    var mur = new Array(13);
    for (var i = 0; i < mur.length; i++)
    {
        mur[i] = new Array(15);
    }
    const scale = 4;
    const mvnt_liberty = 6;
    const speed = 7;
    const start_x = 1;
    const start_y = 1;
    const tile_size = scale * 16;
    const width = 240 * scale;
    const height = 208 * scale;
       var config = {
    type: Phaser.AUTO,
    width: width,
    height: height,
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

function get_coord_x(x)
{
    return ((x + 0.5) * tile_size);
}

function get_coord_y_player(y)
{
    return ((y + 0.5 - 0.5) * tile_size);
}

function get_coord_y(y)
{
    return ((y + 0.5) * tile_size);
}

function get_player_hitbox(x, y)
{
    var hit = tile_size - scale * mvnt_liberty;
    y += 0.5 * tile_size;
    return [[x + hit / 2, y + hit / 2], [x - hit / 2, y + hit / 2], [x + hit / 2, y - hit / 2], [x - hit / 2, y - hit / 2]]; // 0 bottom right; 1 bottom left; 2 top right; 3 top left
}

function get_case(x_y)
{
    return level[Math.floor(x_y[1] / tile_size)][Math.floor(x_y[0] / tile_size)];
}

var game = new Phaser.Game(config);

function preload ()
{
    this.load.image('map', 'terrain.png');

		this.load.image('w_up_0', 'anim_player/W_UP_0.png');
        this.load.image('w_up_1', 'anim_player/W_UP_1.png');
        this.load.image('w_up_2', 'anim_player/W_UP_2.png');
        this.load.image('w_down_0', 'anim_player/W_DOWN_0.png');
        this.load.image('w_down_1', 'anim_player/W_DOWN_1.png');
        this.load.image('w_down_2', 'anim_player/W_DOWN_2.png');
        this.load.image('w_left_0', 'anim_player/W_LEFT_0.png');
        this.load.image('w_left_1', 'anim_player/W_LEFT_1.png');
        this.load.image('w_left_2', 'anim_player/W_LEFT_2.png');
        this.load.image('w_right_0', 'anim_player/W_RIGHT_0.png');
        this.load.image('w_right_1', 'anim_player/W_RIGHT_1.png');
        this.load.image('w_right_2', 'anim_player/W_RIGHT_2.png');
        this.load.image('explo-0-mid', 'anim_bombs/MID_EXPLO_3.png');
        this.load.image('explo-1-mid', 'anim_bombs/MID_EXPLO_2.png');
        this.load.image('explo-2-mid', 'anim_bombs/MID_EXPLO_1.png');
        this.load.image('explo-3-mid', 'anim_bombs/MID_EXPLO_0.png');
        this.load.image('explo-0-midleft', 'anim_bombs/M_LEFT_EXPLO_3.png');
        this.load.image('explo-1-midleft', 'anim_bombs/M_LEFT_EXPLO_2.png');
        this.load.image('explo-2-midleft', 'anim_bombs/M_LEFT_EXPLO_1.png');
        this.load.image('explo-3-midleft', 'anim_bombs/M_LEFT_EXPLO_0.png');
        this.load.image('explo-0-maxleft', 'anim_bombs/T_LEFT_EXPLO_3.png');
        this.load.image('explo-1-maxleft', 'anim_bombs/T_LEFT_EXPLO_2.png');
        this.load.image('explo-2-maxleft', 'anim_bombs/T_LEFT_EXPLO_1.png');
        this.load.image('explo-3-maxleft', 'anim_bombs/T_LEFT_EXPLO_0.png');
        this.load.image('explo-0-midtop', 'anim_bombs/M_UP_EXPLO_3.png');
        this.load.image('explo-1-midtop', 'anim_bombs/M_UP_EXPLO_2.png');
        this.load.image('explo-2-midtop', 'anim_bombs/M_UP_EXPLO_1.png');
        this.load.image('explo-3-midtop', 'anim_bombs/M_UP_EXPLO_0.png');
        this.load.image('explo-0-maxtop', 'anim_bombs/T_UP_EXPLO_3.png');
        this.load.image('explo-1-maxtop', 'anim_bombs/T_UP_EXPLO_2.png');
        this.load.image('explo-2-maxtop', 'anim_bombs/T_UP_EXPLO_1.png');
        this.load.image('explo-3-maxtop', 'anim_bombs/T_UP_EXPLO_0.png');
        this.load.image('explo-0-middown', 'anim_bombs/M_DOWN_EXPLO_3.png');
        this.load.image('explo-1-middown', 'anim_bombs/M_DOWN_EXPLO_2.png');
        this.load.image('explo-2-middown', 'anim_bombs/M_DOWN_EXPLO_1.png');
        this.load.image('explo-3-middown', 'anim_bombs/M_DOWN_EXPLO_0.png');
        this.load.image('explo-0-maxdown', 'anim_bombs/T_DOWN_EXPLO_3.png');
        this.load.image('explo-1-maxdown', 'anim_bombs/T_DOWN_EXPLO_2.png');
        this.load.image('explo-2-maxdown', 'anim_bombs/T_DOWN_EXPLO_1.png');
        this.load.image('explo-3-maxdown', 'anim_bombs/T_DOWN_EXPLO_0.png');
        this.load.image('explo-0-midright', 'anim_bombs/M_RIGHT_EXPLO_3.png');
        this.load.image('explo-1-midright', 'anim_bombs/M_RIGHT_EXPLO_2.png');
        this.load.image('explo-2-midright', 'anim_bombs/M_RIGHT_EXPLO_1.png');
        this.load.image('explo-3-midright', 'anim_bombs/M_RIGHT_EXPLO_0.png');
        this.load.image('explo-0-maxright', 'anim_bombs/T_RIGHT_EXPLO_3.png');
        this.load.image('explo-1-maxright', 'anim_bombs/T_RIGHT_EXPLO_2.png');
        this.load.image('explo-2-maxright', 'anim_bombs/T_RIGHT_EXPLO_1.png');
        this.load.image('explo-3-maxright', 'anim_bombs/T_RIGHT_EXPLO_0.png');
        this.load.image('bomb-0', 'items/Bomb0.png');
        this.load.image('bomb-1', 'items/Bomb1.png');
        this.load.image('bomb-2', 'items/Bomb2.png');
        this.load.image('p_speed', 'items/P_speed.png');
        this.load.image('p_flame_up', 'items/P_flame.png');
        this.load.image('p_bomb', 'items/P_bomb.png');
        this.load.image('p_armor', 'items/P_armor.png');

}

function create ()
{
     key_up = this.input.keyboard.addKey('W');
     key_right = this.input.keyboard.addKey('D');
     key_bottom = this.input.keyboard.addKey('S');
     key_left = this.input.keyboard.addKey('A');

    const map = this.add.image(width / 2, height / 2, 'map');
    map.setScale(scale);
	Players = {
         W_player : this.add.sprite(get_coord_x(start_x), get_coord_y_player(start_y), 'w_down_0'),
		 face : "down",
	};
    create_anim();
	Players.W_player.setScale(scale);
    for (var i = 0; i < level.length; i++) {
        for (var j = 0; j < level[i].length; j++) {
             if (level[i][j] == 2)
             {
                mur[i][j] = this.add.sprite(get_coord_x(j), get_coord_y(i), 'bomb-0');
                mur[i][j].setScale(scale);
             }
         } 
    }
        //W_player = this.add.sprite(get_coord_x(start_x), get_coord_y(start_y), 'w_down_0');
        // W_player.play('w_up');
        // this.add.sprite(200, 200, 'explo-0-mid').play('explo_mid');
        // this.add.sprite(184, 200, 'explo-0-midleft').play('explo_midleft');
        // this.add.sprite(168, 200, 'explo-0-maxleft').play('explo_maxleft');
        // this.add.sprite(200,184, 'explo-0-midtop').play('explo_midtop');
        // this.add.sprite(200,168, 'explo-0-midtop').play('explo_midtop');
        // this.add.sprite(200,150, 'explo-0-midtop').play('explo_midtop');
        // this.add.sprite(200,136, 'explo-0-maxtop').play('explo_maxtop');
        // this.add.sprite(216,200, 'explo-0-midright').play('explo_midright');
        // this.add.sprite(230,200, 'explo-0-maxright').play('explo_maxright');
        // this.add.sprite(200, 216, 'explo-0-middown').play('explo_middown');
        // this.add.sprite(200, 230, 'explo-0-maxdown').play('explo_maxdown');
}

function update ()
{
	movement();
}
    </script>

</body>
</html>
